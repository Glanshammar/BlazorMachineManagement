@inject HttpClient Http
@inject NavigationManager NavigationManager
@inject IHttpClientFactory HttpClientFactory

<EditForm Model="@machine" OnValidSubmit="HandleSubmit">
    <DataAnnotationsValidator />
    <ValidationSummary />

    <div class="form-group">
        <label for="name">Name:</label>
        <InputText id="name" @bind-Value="machine.Name" class="form-control" />
    </div>

    <div class="form-group">
        <label for="maxTemperature">Max Temperature:</label>
        <InputNumber id="maxTemperature" @bind-Value="machine.MaxTemperature" class="form-control" />
    </div>

    <button type="submit" class="btn btn-primary">@(IsNewMachine ? "Add" : "Update") Machine</button>
    <button type="button" class="btn btn-secondary" @onclick="Cancel">Cancel</button>
</EditForm>

@code {
    [Parameter] public Machine machine { get; set; } = new Machine();
    [Parameter] public bool IsNewMachine { get; set; }
    [Parameter] public EventCallback OnCancel { get; set; }
    [Parameter] public EventCallback OnSave { get; set; }
    private HttpClient _httpClient;

    protected override void OnInitialized()
    {
        _httpClient = HttpClientFactory.CreateClient("API");
    }


    private async Task HandleSubmit()
    {
        try
        {
            if (IsNewMachine)
            {
                await _httpClient.PostAsJsonAsync("api/Machines", machine);
            }
            else
            {
                await _httpClient.PutAsJsonAsync($"api/Machines/{machine.Id}", machine);
            }
            await OnSave.InvokeAsync();
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error: {ex.Message}");
        }
    }

    private async Task Cancel()
    {
        await OnCancel.InvokeAsync();
    }
}
